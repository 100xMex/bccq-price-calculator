const { V3WebsocketClient } = require('@okfe/okex-node');

const wss = new V3WebsocketClient();

const MovingTriggerPrice = require('../lib/trigger_price_moving');

const longshort = -1;
const slippage = 0.0005; // 平仓价格滑点

const leverage = 20; // 杠杆率
const fee = 0.0003; // 手续费率 - 考虑杠杆和开平仓手续费, 上来就会亏损 1.2% 左右
const decimal = 0.001; // 精度
const closeRatio = 0.05; // 止损阈值

const mtp = new MovingTriggerPrice(longshort, leverage, fee, closeRatio, slippage, decimal);

wss.connect();
wss.subscribe('futures/ticker:ETH-USD-190927');


// mtp.addCont(10, price);

// const respData = '{"status":200,"msg":"","data":[{"id":1122448956,"t":"11:12:16","T":1560741136,"p":"269.02","n":"4.1151","s":"buy"},{"id":1122448764,"t":"11:12:13","T":1560741133,"p":"268.99","n":"1.9008","s":"sell"},{"id":1122448621,"t":"11:12:10","T":1560741130,"p":"268.98","n":"4.3909","s":"sell"},{"id":1122448534,"t":"11:12:08","T":1560741128,"p":"268.99","n":"0.5652","s":"sell"},{"id":1122448532,"t":"11:12:08","T":1560741128,"p":"268.93","n":"1.4694","s":"buy"},{"id":1122448531,"t":"11:12:08","T":1560741128,"p":"268.95","n":"2.6500","s":"buy"},{"id":1122448530,"t":"11:12:08","T":1560741128,"p":"268.92","n":"2.0000","s":"buy"},{"id":1122448529,"t":"11:12:08","T":1560741128,"p":"268.95","n":"2.2500","s":"sell"},{"id":1122448528,"t":"11:12:08","T":1560741128,"p":"268.91","n":"0.7718","s":"sell"},{"id":1122448527,"t":"11:12:08","T":1560741128,"p":"268.95","n":"1.0000","s":"sell"},{"id":1122448526,"t":"11:12:08","T":1560741128,"p":"268.91","n":"1.4929","s":"buy"},{"id":1122448525,"t":"11:12:08","T":1560741128,"p":"268.97","n":"6.8266","s":"sell"},{"id":1122448516,"t":"11:12:08","T":1560741128,"p":"269.11","n":"1.0651","s":"buy"},{"id":1122448323,"t":"11:12:05","T":1560741125,"p":"268.93","n":"0.6315","s":"sell"},{"id":1122448106,"t":"11:12:02","T":1560741122,"p":"268.91","n":"2.1936","s":"sell"},{"id":1122448105,"t":"11:12:02","T":1560741122,"p":"268.89","n":"6.6629","s":"sell"},{"id":1122447986,"t":"11:11:58","T":1560741118,"p":"268.89","n":"5.6377","s":"buy"},{"id":1122447895,"t":"11:11:56","T":1560741116,"p":"268.88","n":"1.2958","s":"sell"},{"id":1122447894,"t":"11:11:56","T":1560741116,"p":"268.88","n":"0.0858","s":"buy"},{"id":1122447893,"t":"11:11:56","T":1560741116,"p":"268.88","n":"6.5513","s":"buy"},{"id":1122447788,"t":"11:11:54","T":1560741114,"p":"268.88","n":"3.9398","s":"buy"},{"id":1122447649,"t":"11:11:51","T":1560741111,"p":"268.88","n":"0.3801","s":"buy"},{"id":1122447511,"t":"11:11:48","T":1560741108,"p":"268.89","n":"1.6771","s":"buy"},{"id":1122447508,"t":"11:11:48","T":1560741108,"p":"268.89","n":"6.3770","s":"buy"},{"id":1122447326,"t":"11:11:46","T":1560741106,"p":"268.92","n":"5.0887","s":"sell"},{"id":1122447126,"t":"11:11:43","T":1560741103,"p":"268.93","n":"0.2580","s":"sell"},{"id":1122446926,"t":"11:11:40","T":1560741100,"p":"268.93","n":"2.1014","s":"sell"},{"id":1122446764,"t":"11:11:37","T":1560741097,"p":"268.94","n":"1.8793","s":"sell"},{"id":1122446607,"t":"11:11:34","T":1560741094,"p":"268.93","n":"0.5312","s":"sell"},{"id":1122446489,"t":"11:11:34","T":1560741094,"p":"268.94","n":"0.9871","s":"buy"},{"id":1122446417,"t":"11:11:31","T":1560741091,"p":"268.96","n":"3.5533","s":"buy"},{"id":1122446330,"t":"11:11:28","T":1560741088,"p":"268.97","n":"1.0168","s":"buy"},{"id":1122446210,"t":"11:11:27","T":1560741087,"p":"268.98","n":"2.8338","s":"sell"},{"id":1122446057,"t":"11:11:24","T":1560741084,"p":"269.02","n":"0.4231","s":"sell"},{"id":1122446056,"t":"11:11:24","T":1560741084,"p":"268.99","n":"4.9600","s":"sell"},{"id":1122446055,"t":"11:11:24","T":1560741084,"p":"269.01","n":"1.4642","s":"buy"},{"id":1122446053,"t":"11:11:24","T":1560741084,"p":"269.01","n":"4.8330","s":"buy"},{"id":1122446052,"t":"11:11:24","T":1560741084,"p":"268.99","n":"3.5908","s":"sell"},{"id":1122446051,"t":"11:11:24","T":1560741084,"p":"269.01","n":"4.3950","s":"buy"},{"id":1122446050,"t":"11:11:24","T":1560741084,"p":"269.00","n":"3.0000","s":"sell"},{"id":1122446049,"t":"11:11:24","T":1560741084,"p":"269.00","n":"4.6985","s":"buy"},{"id":1122446048,"t":"11:11:24","T":1560741084,"p":"269.02","n":"3.0796","s":"buy"},{"id":1122446047,"t":"11:11:24","T":1560741084,"p":"268.99","n":"3.0810","s":"sell"},{"id":1122446046,"t":"11:11:24","T":1560741084,"p":"269.00","n":"2.1780","s":"sell"},{"id":1122446045,"t":"11:11:24","T":1560741084,"p":"268.99","n":"0.2863","s":"sell"},{"id":1122446044,"t":"11:11:24","T":1560741084,"p":"269.00","n":"1.4324","s":"buy"},{"id":1122446043,"t":"11:11:24","T":1560741084,"p":"268.99","n":"1.7880","s":"sell"},{"id":1122446042,"t":"11:11:24","T":1560741084,"p":"268.99","n":"4.0000","s":"buy"},{"id":1122446041,"t":"11:11:24","T":1560741084,"p":"269.01","n":"8.7510","s":"buy"},{"id":1122445974,"t":"11:11:23","T":1560741083,"p":"269.00","n":"2.3651","s":"sell"}],"time":1560741137,"microtime":"0.61501600 1560741137","source":"api"}';
// const { data } = JSON.parse(respData);
// data.sort((a, b) => a.id > b.id);

// for (let id = 0; id < data.length; id++) {
//   mtp.onPriceChange(data[id].p);
// }
